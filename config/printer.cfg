[include mainsail.cfg]
[include stealthburner_leds.cfg]
[include macros.cfg]
#[include resonance.cfg]
#FLY Mellow SB2040
[mcu SB2040]
canbus_uuid: 270107ba06de

#Cartographer 3D V3.0
[mcu scanner]
canbus_uuid: 3d2f2d5cd73d

#BigTreeTech SKR Pico
[mcu]
serial: /dev/ttyAMA0
restart_method: command


[delayed_gcode Init]
initial_duration: 1
gcode:
  status_ready

[printer]
kinematics: corexz
max_velocity: 500
max_accel: 7000
max_z_velocity: 200
max_z_accel: 5000

[scanner]
mcu: scanner            
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
x_offset: 0                          
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: 25                         
#    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.05697
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
sensor: cartographer
#    this must be set as cartographer unless using IDM etc.
sensor_alt: carto
#    alternate name to call commands. CARTO_TOUCH etc      
mesh_runs: 2
#    Number of passes to make during mesh scan.

[bed_mesh]
zero_reference_position: 108, 108    
speed: 200
horizontal_move_z: 5
mesh_min: 16, 60
mesh_max: 200, 205
probe_count: 30, 30
algorithm: bicubic

[safe_z_home]
home_xy_position: 108, 108
z_hop: 10

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

[stepper_x]
step_pin: gpio11
dir_pin: !gpio10
enable_pin: !gpio12
microsteps: 32
rotation_distance: 40
endstop_pin: SB2040:gpio29
homing_retract_dist: 0
position_endstop: 216
position_min: 0
position_max: 216
homing_speed: 100
full_steps_per_rotation: 200

[tmc2209 stepper_x]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 0
run_current: 0.6

[stepper_y]
step_pin: gpio6
dir_pin: !gpio5
enable_pin: !gpio7
microsteps: 32
rotation_distance: 40.056
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: 232
position_min: 0
position_max: 232
homing_speed: 70
homing_retract_dist: 0
homing_positive_dir: true
full_steps_per_rotation: 200

[tmc2209 stepper_y]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 2
run_current: 0.9
diag_pin: ^gpio3
driver_SGTHRS: 120

[stepper_z]
step_pin: gpio19
dir_pin: !gpio28
enable_pin: !gpio2
microsteps: 32
rotation_distance: 40
endstop_pin: probe:z_virtual_endstop
homing_retract_dist: 0
homing_speed: 10
position_min: -2
position_max: 215
full_steps_per_rotation: 200

[tmc2209 stepper_z]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 1
run_current: 0.6

[extruder]
step_pin: SB2040:gpio9
dir_pin: !SB2040:gpio10
enable_pin: !SB2040:gpio7
gear_ratio: 50:10               #BMG Gear Ratio
microsteps: 32
rotation_distance: 22.573
nozzle_diameter: 0.400
filament_diameter: 1.750
max_extrude_cross_section: 5
heater_pin: SB2040:gpio6
sensor_type: PT1000
pullup_resistor: 1000
sensor_pin: SB2040:gpio27
min_temp: 0
max_temp: 300
max_extrude_only_distance: 120
#control = pid
#pid_kp = 18.575
#pid_ki = 0.799
#pid_kd = 107.970

[tmc2209 extruder]
uart_pin: SB2040:gpio8
run_current: 0.4

[temperature_sensor Toolhead]
sensor_type = ATC Semitec 104GT-2
sensor_pin = SB2040:gpio26
min_temp: 0
max_temp: 120

[temperature_sensor chamber]
sensor_type: EPCOS 100K B57560G104F
sensor_pin: gpio27
min_temp: 0
max_temp: 100
gcode_id: C

[fan]
pin: SB2040:gpio13
kick_start_time: 0.25
off_below: 0.10
cycle_time: 0.008

[heater_fan hotend_fan]
pin: SB2040:gpio14
max_power: 1.0
shutdown_speed: 0.0
cycle_time: 0.01
heater: extruder
heater_temp: 100

[controller_fan mcu_fan]
pin: gpio17
cycle_time: 0.01
fan_speed: 0.5
heater: heater_bed
kick_start_time: 0.200
idle_timeout: 60

[heater_bed]
heater_pin: gpio21
sensor_type: PT1000
sensor_pin: gpio26
min_temp: 0
max_temp: 130
control = pid
pid_kp = 69.025
pid_ki = 1.587
pid_kd = 750.647

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 2000
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.130
#*#
#*# [scanner model default]
#*# model_coef = 1.4044028577649874,
#*# 	1.8413608271016795,
#*# 	0.683862093060326,
#*# 	0.10849385380393775,
#*# 	0.6863407519710811,
#*# 	1.5499056369638058,
#*# 	-0.856818134034186,
#*# 	-2.25967616852834,
#*# 	0.6304518130738244,
#*# 	1.2104528088603377
#*# model_domain = 3.1807813411756665e-07,3.2941479381424383e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 25.248246
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.019317, -0.014393, -0.000488, 0.004581, 0.009901, 0.015555, 0.023386, 0.034371, 0.044172, 0.043035, 0.046834, 0.049896, 0.055445, 0.061678, 0.066199, 0.067095, 0.068166, 0.071451, 0.076684, 0.082264, 0.086858, 0.090884, 0.094300, 0.100195, 0.109345, 0.120095, 0.131807, 0.136940, 0.148335, 0.162820
#*# 	  -0.028628, -0.015363, -0.003436, 0.002545, 0.004912, 0.010220, 0.016897, 0.028893, 0.038557, 0.038376, 0.040933, 0.045232, 0.049850, 0.054441, 0.058400, 0.057581, 0.059581, 0.061443, 0.067196, 0.073234, 0.078733, 0.081377, 0.085017, 0.092316, 0.100438, 0.110260, 0.118004, 0.121962, 0.131326, 0.143332
#*# 	  -0.032781, -0.015694, -0.006207, -0.000662, 0.001888, 0.005675, 0.012444, 0.024024, 0.033984, 0.033623, 0.035482, 0.039450, 0.044215, 0.049337, 0.052165, 0.052390, 0.053360, 0.055189, 0.061549, 0.066267, 0.071235, 0.075437, 0.079078, 0.084690, 0.091630, 0.099808, 0.108261, 0.111750, 0.120519, 0.131120
#*# 	  -0.034013, -0.020564, -0.009726, -0.004050, -0.004219, 0.000888, 0.008861, 0.019718, 0.029455, 0.029431, 0.030779, 0.033777, 0.038555, 0.042577, 0.044876, 0.044187, 0.045871, 0.046879, 0.052159, 0.059876, 0.064678, 0.068563, 0.072437, 0.077645, 0.085054, 0.094154, 0.101226, 0.104619, 0.110879, 0.121640
#*# 	  -0.039038, -0.024452, -0.015600, -0.009617, -0.007636, -0.004302, 0.002606, 0.013681, 0.023560, 0.022911, 0.024778, 0.027223, 0.032433, 0.036567, 0.040362, 0.039868, 0.040356, 0.042238, 0.046429, 0.052611, 0.058798, 0.062596, 0.066526, 0.070982, 0.076504, 0.085761, 0.092663, 0.095880, 0.103398, 0.114269
#*# 	  -0.043307, -0.029721, -0.017831, -0.014319, -0.012862, -0.009903, -0.002828, 0.009268, 0.018859, 0.017410, 0.018147, 0.022449, 0.025926, 0.030541, 0.032096, 0.031313, 0.031664, 0.033419, 0.037761, 0.045040, 0.050591, 0.054687, 0.057481, 0.061331, 0.066446, 0.075451, 0.082509, 0.085186, 0.089304, 0.098036
#*# 	  -0.044140, -0.029633, -0.020879, -0.017431, -0.016197, -0.014959, -0.007792, 0.004876, 0.012366, 0.010728, 0.011199, 0.013828, 0.016767, 0.021385, 0.023129, 0.023676, 0.023774, 0.024676, 0.028733, 0.033705, 0.039129, 0.042762, 0.045320, 0.049556, 0.054323, 0.061305, 0.069215, 0.070075, 0.075154, 0.082540
#*# 	  -0.050116, -0.037014, -0.029618, -0.026223, -0.024309, -0.021064, -0.014898, -0.003708, 0.004422, 0.002161, 0.002139, 0.004831, 0.008327, 0.011712, 0.014908, 0.013023, 0.013602, 0.015456, 0.019152, 0.024762, 0.028594, 0.031332, 0.033909, 0.039352, 0.044569, 0.052519, 0.057769, 0.058774, 0.064364, 0.071501
#*# 	  -0.055946, -0.041854, -0.032254, -0.029891, -0.028347, -0.027527, -0.019738, -0.010372, -0.000594, -0.002833, -0.003320, -0.001433, 0.002359, 0.005944, 0.008458, 0.008419, 0.008274, 0.010167, 0.013163, 0.017472, 0.020674, 0.022690, 0.024754, 0.029202, 0.034413, 0.041680, 0.049436, 0.049320, 0.054638, 0.061355
#*# 	  -0.061642, -0.045018, -0.037050, -0.032988, -0.032823, -0.032381, -0.026924, -0.014828, -0.005943, -0.007790, -0.008729, -0.006133, -0.003601, 0.001524, 0.003546, 0.001784, 0.002725, 0.002912, 0.006737, 0.012141, 0.014072, 0.014639, 0.015991, 0.020521, 0.026801, 0.035760, 0.041563, 0.042396, 0.047359, 0.053252
#*# 	  -0.067242, -0.053099, -0.045659, -0.039453, -0.039280, -0.037684, -0.032722, -0.022729, -0.011599, -0.013519, -0.015249, -0.012348, -0.008920, -0.005845, -0.002430, -0.002042, -0.002575, -0.001872, 0.001788, 0.005401, 0.007234, 0.008095, 0.009348, 0.014635, 0.020933, 0.029450, 0.035304, 0.036588, 0.040961, 0.047894
#*# 	  -0.071345, -0.056957, -0.047906, -0.045024, -0.043759, -0.042073, -0.036428, -0.026471, -0.017798, -0.019462, -0.020162, -0.018149, -0.013828, -0.011984, -0.009589, -0.009989, -0.010060, -0.010462, -0.006203, -0.002729, -0.001075, -0.000165, 0.001473, 0.004903, 0.011941, 0.021054, 0.027455, 0.028575, 0.032224, 0.038022
#*# 	  -0.079202, -0.064721, -0.056594, -0.050584, -0.050758, -0.048560, -0.043371, -0.033563, -0.025523, -0.026813, -0.027551, -0.026741, -0.022250, -0.017990, -0.015436, -0.015271, -0.014773, -0.014401, -0.012057, -0.007322, -0.005933, -0.005831, -0.004559, 0.000371, 0.005497, 0.013700, 0.020882, 0.020666, 0.025312, 0.031884
#*# 	  -0.082780, -0.068992, -0.059495, -0.056292, -0.056148, -0.053197, -0.048438, -0.038990, -0.030306, -0.033386, -0.035266, -0.032618, -0.028852, -0.024804, -0.021852, -0.023127, -0.023122, -0.022895, -0.020235, -0.016370, -0.014651, -0.013447, -0.012183, -0.008741, -0.001182, 0.008014, 0.012825, 0.011628, 0.013618, 0.018474
#*# 	  -0.090218, -0.075676, -0.068467, -0.064161, -0.064226, -0.062411, -0.056584, -0.046945, -0.040937, -0.042810, -0.044287, -0.042685, -0.039075, -0.033423, -0.029878, -0.031961, -0.030948, -0.030072, -0.028136, -0.023850, -0.021218, -0.021771, -0.019019, -0.014977, -0.010216, -0.002113, 0.004489, 0.004206, 0.006880, 0.012638
#*# 	  -0.095632, -0.081050, -0.072884, -0.070556, -0.071129, -0.068317, -0.062406, -0.053166, -0.046154, -0.049630, -0.050688, -0.048917, -0.044593, -0.038791, -0.035047, -0.036521, -0.037090, -0.037359, -0.034515, -0.029915, -0.028274, -0.027972, -0.026084, -0.023211, -0.017056, -0.007481, -0.001435, -0.002064, 0.000874, 0.002673
#*# 	  -0.095032, -0.082026, -0.076105, -0.073043, -0.073886, -0.071088, -0.065574, -0.056297, -0.048299, -0.050838, -0.053771, -0.051466, -0.047221, -0.043534, -0.039533, -0.040209, -0.041171, -0.041774, -0.039783, -0.036508, -0.034549, -0.033782, -0.033929, -0.029316, -0.023558, -0.015099, -0.009294, -0.009421, -0.007133, -0.000975
#*# 	  -0.095282, -0.082240, -0.074700, -0.072680, -0.073489, -0.072202, -0.065846, -0.055742, -0.049332, -0.052016, -0.053727, -0.050874, -0.048735, -0.044547, -0.042604, -0.044003, -0.045394, -0.045760, -0.043319, -0.038596, -0.037511, -0.037597, -0.036216, -0.033497, -0.026550, -0.018584, -0.013412, -0.015160, -0.015136, -0.010115
#*# 	  -0.091329, -0.080645, -0.075512, -0.074219, -0.074770, -0.072673, -0.066844, -0.058131, -0.049746, -0.051383, -0.052559, -0.050420, -0.047584, -0.044716, -0.043498, -0.044290, -0.045181, -0.046170, -0.043200, -0.039370, -0.038970, -0.039775, -0.040086, -0.036369, -0.031004, -0.024126, -0.018079, -0.019617, -0.016532, -0.012130
#*# 	  -0.090262, -0.078190, -0.073368, -0.072497, -0.071913, -0.070969, -0.065279, -0.057567, -0.047983, -0.050730, -0.051598, -0.048902, -0.046934, -0.044826, -0.043073, -0.045579, -0.047698, -0.046573, -0.043570, -0.041297, -0.040394, -0.041616, -0.042361, -0.039393, -0.033789, -0.024986, -0.020290, -0.021431, -0.020469, -0.016539
#*# 	  -0.091861, -0.081102, -0.077129, -0.073358, -0.074239, -0.073051, -0.067649, -0.056998, -0.050178, -0.051792, -0.052168, -0.050244, -0.047100, -0.044042, -0.042518, -0.044005, -0.044273, -0.044759, -0.041642, -0.038575, -0.038791, -0.041930, -0.042149, -0.038944, -0.033408, -0.028821, -0.023587, -0.024067, -0.021432, -0.016911
#*# 	  -0.085578, -0.075729, -0.071049, -0.069243, -0.070464, -0.069093, -0.063222, -0.055748, -0.046860, -0.049735, -0.050783, -0.049140, -0.045509, -0.042958, -0.042195, -0.044204, -0.043955, -0.043820, -0.041599, -0.039331, -0.039514, -0.043996, -0.044109, -0.041547, -0.035282, -0.029900, -0.025976, -0.028314, -0.027326, -0.023476
#*# 	  -0.078205, -0.070728, -0.067668, -0.068030, -0.069249, -0.068506, -0.063480, -0.054004, -0.047267, -0.049980, -0.050084, -0.047918, -0.046760, -0.043787, -0.042679, -0.044256, -0.044608, -0.044435, -0.043450, -0.041090, -0.041479, -0.046412, -0.047092, -0.044512, -0.040761, -0.035299, -0.031909, -0.034364, -0.030950, -0.026278
#*# 	  -0.078041, -0.066594, -0.062911, -0.063792, -0.064063, -0.063903, -0.057760, -0.050416, -0.043435, -0.046373, -0.048041, -0.047358, -0.045269, -0.042973, -0.043228, -0.044300, -0.045138, -0.045687, -0.043539, -0.041102, -0.042881, -0.047204, -0.047541, -0.047013, -0.041916, -0.036621, -0.034310, -0.036878, -0.036756, -0.033329
#*# 	  -0.075376, -0.066312, -0.062340, -0.062393, -0.064464, -0.063208, -0.057425, -0.048799, -0.042264, -0.045029, -0.046432, -0.045412, -0.044947, -0.042418, -0.041974, -0.044549, -0.044244, -0.044720, -0.043957, -0.042097, -0.043122, -0.046607, -0.049829, -0.046941, -0.043195, -0.038377, -0.035450, -0.037664, -0.035273, -0.029152
#*# 	  -0.070618, -0.061548, -0.056648, -0.057302, -0.058844, -0.057707, -0.052214, -0.045642, -0.039413, -0.042418, -0.044564, -0.043844, -0.041705, -0.040924, -0.041269, -0.042219, -0.043253, -0.044365, -0.043941, -0.042107, -0.043944, -0.047309, -0.048879, -0.047599, -0.043504, -0.038333, -0.035964, -0.040431, -0.040171, -0.034088
#*# 	  -0.066037, -0.056278, -0.054123, -0.054634, -0.055145, -0.054422, -0.048848, -0.041505, -0.036060, -0.040047, -0.042185, -0.042111, -0.040180, -0.038431, -0.038247, -0.039974, -0.041860, -0.043838, -0.043312, -0.042221, -0.043700, -0.047837, -0.050322, -0.048507, -0.044985, -0.040462, -0.038374, -0.041955, -0.040392, -0.034350
#*# 	  -0.060835, -0.048842, -0.046577, -0.048687, -0.050083, -0.048306, -0.044489, -0.037663, -0.031698, -0.035913, -0.038769, -0.037695, -0.036394, -0.034884, -0.034178, -0.037567, -0.039056, -0.041309, -0.040549, -0.039489, -0.041738, -0.046528, -0.048286, -0.046911, -0.044898, -0.038757, -0.037573, -0.040071, -0.038064, -0.035971
#*# 	  -0.051673, -0.044767, -0.043102, -0.044972, -0.046773, -0.045802, -0.041964, -0.032644, -0.028492, -0.031494, -0.034991, -0.036546, -0.034482, -0.031844, -0.031981, -0.035223, -0.037809, -0.040105, -0.039355, -0.038159, -0.039780, -0.044886, -0.047597, -0.046454, -0.044478, -0.039756, -0.038234, -0.039446, -0.035575, -0.029007
#*# 	  -0.044158, -0.036957, -0.035704, -0.037900, -0.039671, -0.040724, -0.036053, -0.028292, -0.023615, -0.028546, -0.031814, -0.031874, -0.030158, -0.027871, -0.027981, -0.031882, -0.035233, -0.036252, -0.036631, -0.035376, -0.037716, -0.043082, -0.044143, -0.043070, -0.041144, -0.035881, -0.034332, -0.038537, -0.036420, -0.029392
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 16.0
#*# max_x = 200.0
#*# min_y = 60.0
#*# max_y = 205.0
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 65.2
#*# shaper_type_y = mzv
#*# shaper_freq_y = 50.6
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 18.238
#*# pid_ki = 0.770
#*# pid_kd = 108.065
